# 22 | MySQL有哪些“饮鸩止渴”提高性能的方法?

## 短连接风暴
正常的短连接模式就是连接到数据库后，执行很少的 SQL 语句就断开，下次需要的时候再 重连。如果使用的是短连接，在业务高峰期的时候，就可能出现连接数突然暴涨的情况。

**MySQL 建立连接的过程，成本是很高的**。除了正常的网络连接三次握手外，还需要做登录权限判断和获得这个连接的数据读写权限。

**max_connections** 参数，用来控制一个 MySQL 实例同时存在的连接数的上限，超过这个 值，系统就会拒绝接下来的连接请求，并报错提示“Too many connections”。对于被拒 绝连接的请求来说，从业务角度看就是数据库不可用。

这些方法都是有损的。
1. 第一种方法:先处理掉那些占着连接但是不工作的线程。
    - 如果是连接数过多，你可以优先断开事务外空闲太久的连接;如果这样还不够，再考虑断开事务内空闲太久的连接。
2. 第二种方法:减少连接过程的消耗。
跳过权限验证的方法是:重启数据库，并使用–skip-grant-tables 参数启动。这样，整个 MySQL 会跳过所有的权限验证阶段，包括连接过程和语句执行过程在内。

## 慢查询性能问题
1. 索引没有设计好;
2. SQL 语句没写好;
3. MySQL 选错了索引。

## QPS 突增问题

1. 一种是由全新业务的 bug 导致的。假设你的 DB 运维是比较规范的，也就是说白名单是 一个个加的。这种情况下，如果你能够确定业务方会下掉这个功能，只是时间上没那么 快，那么就可以从数据库端直接把白名单去掉。
2. 如果这个新功能使用的是单独的数据库用户，可以用管理员账号把这个用户删掉，然后 断开现有连接。这样，这个新功能的连接不成功，由它引发的 QPS 就会变成 0。
3. 如果这个新增的功能跟主体功能是部署在一起的，那么我们只能通过处理语句来限制。 这时，我们可以使用上面提到的查询重写功能，把压力最大的 SQL 语句直接重写 成"select 1"返回。
