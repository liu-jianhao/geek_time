# 06 | 全局锁和表锁 :给表加个字段怎么有这么多阻碍?

**根据加锁的范围，MySQL 里面的锁大致可以分成全局锁、表级锁和行锁三类。**

## 全局锁
全局锁就是对整个数据库实例加锁。

MySQL 提供了一个加全局读锁的方法，命 令是 Flush tables with read lock (FTWRL)。

全局锁的典型使用场景是，做全库逻辑备份。

官方自带的逻辑备份工具是 mysqldump。当 mysqldump 使用参数–single-transaction 的时候，导数据之前就会启动一个事务，来确保拿到一致性视图。而由于 MVCC 的支持， 这个过程中数据是可以正常更新的。


有了这个功能，为什么还需要 FTWRL 呢?一致性读是好，但前提是引擎要 支持这个隔离级别。比如，对于 MyISAM 这种不支持事务的引擎，如果备份过程中有更 新，总是只能取到最新的数据，那么就破坏了备份的一致性。这时，我们就需要使用 FTWRL 命令了。

所以，single-transaction 方法只适用于所有的表使用事务引擎的库。如果有的表使用了 不支持事务的引擎，那么备份就只能通过 FTWRL 方法。

## 表级锁
MySQL 里面表级别的锁有两种:一种是表锁，一种是元数据锁(meta data lock， MDL)。

表锁的语法是 lock tables ... read/write。

另一类表级的锁是 MDL(metadata lock)。MDL 不需要显式使用，在访问一个表的时候 会被自动加上。MDL 的作用是，保证读写的正确性。你可以想象一下，如果一个查询正在遍历一个表中的数据，而执行期间另一个线程对这个表结构做变更，删了一列，那么查询线程拿到的结果跟表结构对不上，肯定是不行的。

因此，在 MySQL 5.5 版本中引入了 MDL，当对一个表做增删改查操作的时候，加 MDL 读锁;当要对表做结构变更操作的时候，加 MDL 写锁。
